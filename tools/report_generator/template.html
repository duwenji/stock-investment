<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{stock_name}} ({{stock_code}}) - 株式分析レポート</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }
        
        .header .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .header .date {
            margin-top: 10px;
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        .content {
            padding: 30px;
        }
        
        .section {
            margin-bottom: 40px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .info-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .info-card h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .info-label {
            font-weight: 600;
            color: #495057;
        }
        
        .info-value {
            color: #212529;
            text-align: right;
        }
        
        .signal-buy {
            color: #28a745;
            font-weight: bold;
        }
        
        .signal-sell {
            color: #dc3545;
            font-weight: bold;
        }
        
        .signal-neutral {
            color: #6c757d;
            font-weight: bold;
        }
        
        .chart-container {
            margin: 20px 0;
            text-align: center;
        }
        
        .chart-container img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .summary-box {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            padding: 25px;
            border-radius: 10px;
            margin: 30px 0;
            text-align: center;
        }
        
        .summary-box h3 {
            font-size: 1.8em;
            margin-bottom: 15px;
            color: #2c3e50;
        }
        
        .summary-signal {
            font-size: 2.5em;
            font-weight: bold;
            margin: 20px 0;
        }
        
        .summary-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .summary-item {
            background: rgba(255,255,255,0.8);
            padding: 15px;
            border-radius: 8px;
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .table th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        .table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .table tr:hover {
            background: #f8f9fa;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            background: #2c3e50;
            color: white;
            margin-top: 40px;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .content {
                padding: 15px;
            }
            
            .section {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ヘッダー -->
        <div class="header">
            <h1>{{stock_name}} ({{stock_code}})</h1>
            <div class="subtitle">株式分析レポート - 短期トレード向け</div>
            <div class="date">分析日時: {{analysis_date}}</div>
        </div>
        
        <div class="content">
            <!-- 総合評価 -->
            <div class="summary-box">
                <h3>総合投資判断</h3>
                <div class="summary-signal {{overall_signal_class}}">{{overall_signal}}</div>
                <div class="summary-details">
                    <div class="summary-item">
                        <strong>買いシグナル</strong><br>
                        <span class="signal-buy">{{buy_count}} 個</span>
                    </div>
                    <div class="summary-item">
                        <strong>売りシグナル</strong><br>
                        <span class="signal-sell">{{sell_count}} 個</span>
                    </div>
                    <div class="summary-item">
                        <strong>現在価格</strong><br>
                        {{current_price}} 円
                    </div>
                    <div class="summary-item">
                        <strong>ボラティリティ</strong><br>
                        {{volatility_20d}}%
                    </div>
                </div>
            </div>
            
            <!-- 基本情報 -->
            <div class="section">
                <h2>銘柄基本情報</h2>
                <div class="info-grid">
                    <div class="info-card">
                        <h3>企業情報</h3>
                        <div class="info-item">
                            <span class="info-label">銘柄コード</span>
                            <span class="info-value">{{stock_code}}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">銘柄名</span>
                            <span class="info-value">{{stock_name}}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">業種</span>
                            <span class="info-value">{{industry}}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">市場</span>
                            <span class="info-value">{{market}}</span>
                        </div>
                    </div>
                    
                    <div class="info-card">
                        <h3>投資情報</h3>
                        <div class="info-item">
                            <span class="info-label">現在価格</span>
                            <span class="info-value">{{current_price}} 円</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">1日変動</span>
                            <span class="info-value {{price_change_1d_class}}">{{price_change_1d}}%</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">5日変動</span>
                            <span class="info-value {{price_change_5d_class}}">{{price_change_5d}}%</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">20日変動</span>
                            <span class="info-value {{price_change_20d_class}}">{{price_change_20d}}%</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 価格チャート -->
            {% if price_chart_path %}
            <div class="section">
                <h2>価格推移チャート</h2>
                <div class="chart-container">
                    <img src="{{price_chart_path}}" alt="{{stock_code}} 価格チャート">
                </div>
            </div>
            {% endif %}
            
            <!-- テクニカル指標 -->
            <div class="section">
                <h2>テクニカル指標</h2>
                <div class="info-grid">
                    <div class="info-card">
                        <h3>トレンド指標</h3>
                        <div class="info-item">
                            <span class="info-label">5日移動平均</span>
                            <span class="info-value">{{sma_5}} 円</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">20日移動平均</span>
                            <span class="info-value">{{sma_20}} 円</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">50日移動平均</span>
                            <span class="info-value">{{sma_50}} 円</span>
                        </div>
                    </div>
                    
                    <div class="info-card">
                        <h3>モメンタム指標</h3>
                        <div class="info-item">
                            <span class="info-label">RSI(14)</span>
                            <span class="info-value {{rsi_class}}">{{rsi_14}}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">ストキャスティクス %K</span>
                            <span class="info-value {{stoch_k_class}}">{{stoch_k}}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">ストキャスティクス %D</span>
                            <span class="info-value {{stoch_d_class}}">{{stoch_d}}</span>
                        </div>
                    </div>
                    
                    <div class="info-card">
                        <h3>ボラティリティ指標</h3>
                        <div class="info-item">
                            <span class="info-label">ボリンジャーバンド上限</span>
                            <span class="info-value">{{bb_upper}} 円</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">ボリンジャーバンド下限</span>
                            <span class="info-value">{{bb_lower}} 円</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">ボラティリティ(20日)</span>
                            <span class="info-value">{{volatility_20d}}%</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- テクニカルチャート -->
            {% if technical_chart_path %}
            <div class="section">
                <h2>テクニカル指標チャート</h2>
                <div class="chart-container">
                    <img src="{{technical_chart_path}}" alt="{{stock_code}} テクニカル指標チャート">
                </div>
            </div>
            {% endif %}
            
            <!-- トレードシグナル -->
            <div class="section">
                <h2>トレードシグナル詳細</h2>
                <table class="table">
                    <thead>
                        <tr>
                            <th>指標</th>
                            <th>シグナル</th>
                            <th>強度</th>
                            <th>説明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>RSI</td>
                            <td><span class="{{rsi_signal_class}}">{{rsi_signal}}</span></td>
                            <td>{{rsi_strength}}</td>
                            <td>RSIが{{rsi_14}}で{{rsi_interpretation}}</td>
                        </tr>
                        <tr>
                            <td>MACD</td>
                            <td><span class="{{macd_signal_class}}">{{macd_signal}}</span></td>
                            <td>-</td>
                            <td>MACDラインとシグナルラインの位置関係</td>
                        </tr>
                        <tr>
                            <td>ボリンジャーバンド</td>
                            <td><span class="{{bb_signal_class}}">{{bb_signal}}</span></td>
                            <td>-</td>
                            <td>現在価格とバンドの位置関係</td>
                        </tr>
                        <tr>
                            <td>ストキャスティクス</td>
                            <td><span class="{{stoch_signal_class}}">{{stoch_signal}}</span></td>
                            <td>-</td>
                            <td>%Kと%Dの水準とクロス状況</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- シグナルサマリー -->
            {% if signal_summary_path %}
            <div class="section">
                <h2>シグナル分布</h2>
                <div class="chart-container">
                    <img src="{{signal_summary_path}}" alt="{{stock_code}} シグナル分布">
                </div>
            </div>
            {% endif %}
            
            <!-- ポートフォリオ情報 -->
            {% if portfolio_info %}
            <div class="section">
                <h2>ポートフォリオ情報</h2>
                <table class="table">
                    <thead>
                        <tr>
                            <th>保有区分</th>
                            <th>証券会社</th>
                            <th>取得日</th>
                            <th>取得価格</th>
                            <th>数量</th>
                            <th>現在価格</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for holding in portfolio_info %}
                        <tr>
                            <td>{{holding.holding_type}}</td>
                            <td>{{holding.broker}}</td>
                            <td>{{holding.purchase_date}}</td>
                            <td>{{holding.purchase_price}} 円</td>
                            <td>{{holding.quantity}} 株</td>
                            <td>{{holding.current_price}} 円</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% endif %}
            
            <!-- 取引計画 -->
            {% if trading_plans %}
            <div class="section">
                <h2>取引計画</h2>
                <table class="table">
                    <thead>
                        <tr>
                            <th>分析日</th>
                            <th>分析タイプ</th>
                            <th>配分比率</th>
                            <th>備考</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for plan in trading_plans %}
                        <tr>
                            <td>{{plan.analysis_date}}</td>
                            <td>{{plan.analysis_type}}</td>
                            <td>{{plan.allocation_percentage}}%</td>
                            <td>{{plan.notes}}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% endif %}
        </div>
        
        <!-- フッター -->
        <div class="footer">
            <p>株式投資アシスタント - 自動生成レポート</p>
            <p>このレポートは自動的に生成されました。投資判断は自己責任でお願いします。</p>
        </div>
    </div>
</body>
</html>
